) %>%
filter(valor == TRUE | valor == 1) %>%
group_by(meses_en_lugar, grupo) %>%
summarise(conteo = n(), .groups = "drop") %>%
mutate(
grupo = recode(grupo,
grupo_medios     = "Medios de vida y economía",
grupo_vivienda   = "Vivienda y servicios básicos",
grupo_alimentos  = "Alimentación y artículos básicos",
grupo_salud      = "Salud y bienestar",
grupo_proteccion = "Protección y educación",
grupo_noclas     = "No clasificable"
)
necesidades_long
# Gráfico de líneas
ggplot(necesidades_long, aes(x = meses_en_lugar, y = conteo, color = grupo, group = grupo)) +
geom_line(size = 1) +
geom_point(size = 2) +
labs(
title = "Evolución de las necesidades según tiempo de residencia",
x = "Tiempo de residencia (meses)",
y = "Número de hogares",
color = "Grupo de necesidad"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "bottom"
)
# Pasamos a formato largo: hogares x necesidades
necesidades_hacinamiento <- tabla_necesidades_agrupada %>%
select(hacinamiento,
grupo_medios,
grupo_vivienda,
grupo_alimentos,
grupo_salud,
grupo_proteccion,
grupo_noclas) %>%
pivot_longer(
cols = starts_with("grupo"),
names_to = "grupo",
values_to = "valor"
) %>%
filter(valor == TRUE | valor == 1) %>%
group_by(hacinamiento, grupo) %>%
summarise(conteo = n(), .groups = "drop") %>%
mutate(
grupo = recode(grupo,
grupo_medios     = "Medios de vida y economía",
grupo_vivienda   = "Vivienda y servicios básicos",
grupo_alimentos  = "Alimentación y artículos básicos",
grupo_salud      = "Salud y bienestar",
grupo_proteccion = "Protección y educación",
grupo_noclas     = "No clasificable"
)
# Ordenar dentro de cada categoría de hacinamiento
necesidades_hacinamiento <- necesidades_hacinamiento %>%
group_by(hacinamiento) %>%
arrange(desc(conteo), .by_group = TRUE)
necesidades_hacinamiento
ggplot(necesidades_hacinamiento, aes(x = grupo, y = conteo, fill = grupo)) +
geom_col(show.legend = FALSE) +
facet_wrap(~ hacinamiento, scales = "free_y") +
labs(
title = "Necesidades más frecuentes según tipo de hacinamiento",
x = "Grupo de necesidad",
y = "Número de hogares"
) +
theme_minimal() +
theme(
strip.text = element_text(size = 11, face = "bold"),
axis.text.x = element_text(angle = 45, hjust = 1, size = 7), # más pequeño
axis.title.x = element_text(margin = margin(t = 10))
)
# Calcular totales por tipo de hacinamiento (para base de porcentajes)
totales <- tabla_necesidades_agrupada %>%
group_by(hacinamiento) %>%
summarise(total_hogares = n(), .groups = "drop")
# Transformar a formato largo y calcular porcentajes
necesidades_hacinamiento <- tabla_necesidades_agrupada %>%
select(hacinamiento,
grupo_medios,
grupo_vivienda,
grupo_alimentos,
grupo_salud,
grupo_proteccion,
grupo_noclas) %>%
pivot_longer(
cols = starts_with("grupo"),
names_to = "grupo",
values_to = "valor"
) %>%
filter(valor == TRUE | valor == 1) %>%
group_by(hacinamiento, grupo) %>%
summarise(conteo = n(), .groups = "drop") %>%
left_join(totales, by = "hacinamiento") %>%
mutate(
pct = (conteo / total_hogares) * 100,
grupo = recode(grupo,
grupo_medios     = "Medios de vida y economía",
grupo_vivienda   = "Vivienda y servicios básicos",
grupo_alimentos  = "Alimentación y artículos básicos",
grupo_salud      = "Salud y bienestar",
grupo_proteccion = "Protección y educación",
grupo_noclas     = "No clasificable"
)
# Gráfica: barras agrupadas por tipo de hacinamiento dentro de cada necesidad
ggplot(necesidades_hacinamiento, aes(x = grupo, y = pct, fill = hacinamiento)) +
geom_col(position = "dodge") +
labs(
title = "Porcentaje de hogares con necesidades según tipo de hacinamiento",
x = "Grupo de necesidad",
y = "Porcentaje de hogares",
fill = "Tipo de hacinamiento"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
axis.title.x = element_text(margin = margin(t = 10))
)
vars_mediosvida <- c(
"miembros21",  # Tiempo dedicado
"miembros22",  # Horas trabajadas
"miembros23",  # Trabajaria mas
"miembros23a",  # quiere trabajar mas
"miembros30",  # Cuenta con contrato formal
"miembros30b",   # Seguridad social en salud
"miembros31a",  # Seguridad social pension
"miembros21b",  # Rango de ingresos
"miembros24a",  # Reporto dificultades para encontrar trabajo
"miembros24b_dificultades_nodocu",  ### Razones ####
"miembros24b_dificultades_familia",
"miembros24b_dificultades_discrimina",
"miembros24b_dificultades_noconocimi",
"miembros24b_dificultades_noempleo",
"miembros24b_dificultades_noofertas",
"miembros24b_dificultades_noexperiencia",
"miembros24b_dificultades_otra",
"miembros24b_nosabe",
"miembros24b_noresponde" #############
)
# Resumen de valores perdidos (NA) en estas variables
na_resumen_mediosvida <- sapply(data_bogota[vars_mediosvida], function(x) sum(is.na(x)))
na_resumen_mediosvida
vars_24b <- c(
"miembros24b_dificultades_nodocu",
"miembros24b_dificultades_familia",
"miembros24b_dificultades_discrimina",
"miembros24b_dificultades_noconocimi",
"miembros24b_dificultades_noempleo",
"miembros24b_dificultades_noofertas",
"miembros24b_dificultades_noexperiencia",
"miembros24b_dificultades_otra",
"miembros24b_nosabe",
"miembros24b_noresponde"
)
data_bogota <- data_bogota %>%
rowwise() %>%
mutate(
across(all_of(vars_24b), ~ case_when(
#En caso de que no haya reportado dificultades con miembros24a = no, no ha buscado empleo, no sabe
miembros24a %in% c("no", "no ha buscado empleo", "no sabe") & is.na(.x) ~ 0,
# Pero si respondio que si encontro dificultades (miembros24a = si) y hay al menos una de las variables igual a 1, se asume que el resto no ocurrieron
miembros24a == "si" & any(c_across(all_of(vars_24b)) == 1, na.rm = TRUE) & is.na(.x) ~ 0,
TRUE ~ .x
))
) %>%
ungroup()
# Resumen de valores perdidos (NA) en estas variables
na_resumen_mediosvida <- sapply(data_bogota[vars_mediosvida], function(x) sum(is.na(x)))
na_resumen_mediosvida
vars_principales <- c(
"miembros21",
"miembros30",
"miembros30b",
"miembros31a",
"miembros21b"
)
tabla_cruzada_miembros21 <- data_bogota %>%
count(miembros21, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros21
tabla_cruzada_miembros30 <- data_bogota %>%
count(miembros30, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros30
tabla_cruzada_miembros30b <- data_bogota %>%
count(miembros30b, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros30b
tabla_cruzada_miembros31a <- data_bogota %>%
count(miembros31a, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros31a
tabla_cruzada_miembros21b <- data_bogota %>%
count(miembros21b, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros21b
library(gridExtra)
##### SALUD ######
p1 <- ggplot(data_bogota %>%
filter(!is.na(miembros30b)) %>%
count(meses_en_lugar, miembros30b) %>%
mutate(miembros30b = str_wrap(miembros30b, width = 25)), # salto de línea
aes(x = meses_en_lugar, y = n, fill = miembros30b)) +
geom_col(position = "dodge") +
labs(
title = "Acceso a seguridad social en salud",
x = "Meses en el lugar",
y = "Número de hogares",
fill = "Respuesta"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
plot.title = element_text(size = 12, face = "bold"),
legend.position = "bottom",
legend.title = element_text(size = 9),
legend.text = element_text(size = 8)
)
##### PENSION ######
p2 <- ggplot(data_bogota %>%
filter(!is.na(miembros31a)) %>%
count(meses_en_lugar, miembros31a) %>%
mutate(miembros31a = str_wrap(miembros31a, width = 25)), # salto de línea
aes(x = meses_en_lugar, y = n, fill = miembros31a)) +
geom_col(position = "dodge") +
labs(
title = "Acceso a seguridad social en pensiones",
x = "Meses en el lugar",
y = "Número de hogares",
fill = "Respuesta"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
plot.title = element_text(size = 12, face = "bold"),
legend.position = "bottom",
legend.title = element_text(size = 9),
legend.text = element_text(size = 8)
)
grid.arrange(p1, p2, ncol = 2)
ggplot(data_bogota %>%
filter(!is.na(miembros21b)) %>%
count(meses_en_lugar, miembros21b) %>%
mutate(miembros21b = str_wrap(miembros21b, width = 30)),  # ajusta ancho del texto
aes(x = meses_en_lugar, y = n, fill = miembros21b)) +
geom_col(position = "dodge", width = 0.8) +
labs(
title = "Rangos de ingresos mensuales",
x = "Meses en el lugar",
y = "Número de hogares",
fill = "Ingreso mensual"
) +
theme_minimal(base_size = 12) +
theme(
legend.position = "bottom",
legend.title = element_text(size = 9),
legend.text = element_text(size = 8),
axis.text.x = element_text(angle = 30, hjust = 1)
)
vars_dificultades <- c(
"miembros24b_dificultades_nodocu",
"miembros24b_dificultades_familia",
"miembros24b_dificultades_discrimina",
"miembros24b_dificultades_noconocimi",
"miembros24b_dificultades_noempleo",
"miembros24b_dificultades_noofertas",
"miembros24b_dificultades_noexperiencia",
"miembros24b_dificultades_otra",
"miembros24b_nosabe",
"miembros24b_noresponde"
)
dificultades_long <- data_bogota %>%
select(all_of(vars_dificultades)) %>%
pivot_longer(cols = everything(),
names_to = "dificultad",
values_to = "valor") %>%
filter(valor == 1)
# Para las dificultades agrupadas
cruce_dificultades <- data_bogota %>%
select(meses_en_lugar, all_of(vars_dificultades)) %>%
pivot_longer(cols = -meses_en_lugar,
names_to = "dificultad",
values_to = "valor") %>%
filter(valor == 1) %>%
count(meses_en_lugar, dificultad, name = "frecuencia") %>%
pivot_wider(names_from = meses_en_lugar,
values_from = frecuencia,
values_fill = 0)
cruce_dificultades
ggplot(cruce_dificultades,
aes(x = meses_en_lugar, y = frecuencia, fill = dificultad)) +
geom_col(position = "dodge") +
labs(
title = "Dificultades reportadas según tiempo de permanencia",
x = "Meses en el lugar",
y = "Número de hogares",
fill = "Dificultad"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 9),
legend.position = "bottom",
legend.text = element_text(size = 8)
)
df_meses <- data_migracion %>%
count(meses_en_lugar) %>%
mutate(porc = round(100 * n / sum(n), 1))
g_meses <- ggplot(df_meses, aes(x = meses_en_lugar, y = porc)) +
geom_col(fill = "#4A90E2") +
geom_text(aes(label = paste0(porc, "%")), vjust = -0.4, size = 3.8) +
labs(
title = "Tiempo de permanencia en el lugar de residencia actual",
x = "Meses en el lugar",
y = "Porcentaje de hogares"
) +
theme_minimal(base_size = 12)
# Guardar
ggsave("stores/tiempo_permanencia_residencia.png", g_meses,
width = 8, height = 5, dpi = 300)
rm(g_meses, df_meses)
resumen_agua <- data_migracion %>%
distinct(id_hogar, intro5, Acueducto_casa, AguaPublica_fueradecasa,
Agua_FuentesNaturales, Agua_FuentesPrivadas, Agua_NoAcceso) %>%
group_by(intro5) %>%
summarise(
hogares_con_Acueducto = sum(Acueducto_casa, na.rm = TRUE),
hogares_con_AguaPublica_fuera = sum(AguaPublica_fueradecasa, na.rm = TRUE),
hogares_con_AguaNatural = sum(Agua_FuentesNaturales, na.rm = TRUE),
hogares_con_AguaPrivada = sum(Agua_FuentesPrivadas, na.rm = TRUE),
hogares_sin_Agua = sum(Agua_NoAcceso, na.rm = TRUE),
total_hogares = n(),
.groups = "drop"
) %>%
mutate(
pct_Acueducto = round(100 * hogares_con_Acueducto / total_hogares, 1),
pct_AguaPublica_fuera = round(100 * hogares_con_AguaPublica_fuera / total_hogares, 1),
pct_AguaNatural = round(100 * hogares_con_AguaNatural / total_hogares, 1),
pct_AguaPrivada = round(100 * hogares_con_AguaPrivada / total_hogares, 1),
pct_NoAcceso = round(100 * hogares_sin_Agua / total_hogares, 1)
)
# CAMINAR PARA ACCEDER A AGUA (CORTO < 30 MIN, LARGO > 30 MIN)
resumen_caminar <- data_migracion %>%
distinct(id_hogar, intro5, Agua_caminar_largo, Agua_caminar_corto) %>%
group_by(intro5) %>%
summarise(
hogares_largo = sum(Agua_caminar_largo, na.rm = TRUE),
hogares_corto = sum(Agua_caminar_corto, na.rm = TRUE),
total_hogares = n(),
.groups = "drop"
) %>%
mutate(
pct_largo = round(100 * hogares_largo / total_hogares, 1),
pct_corto = round(100 * hogares_corto / total_hogares, 1)
) %>%
arrange(desc(total_hogares))
resumen_caminar
# ACCESO A SANEAMIENTO
resumen_saneamiento <- data_migracion %>%
distinct(id_hogar, intro5,
Saneamiento_deCalidad, Saneamiento_noCalidad,
Saneamiento_Letrina, Saneamiento_Privado,
Saneamiento_UsoPublico, Saneamiento_SinCobertura) %>%
group_by(intro5) %>%
summarise(
hogares_deCalidad     = sum(Saneamiento_deCalidad, na.rm = TRUE),
hogares_noCalidad     = sum(Saneamiento_noCalidad, na.rm = TRUE),
hogares_Letrina       = sum(Saneamiento_Letrina, na.rm = TRUE),
hogares_Privado       = sum(Saneamiento_Privado, na.rm = TRUE),
hogares_UsoPublico    = sum(Saneamiento_UsoPublico, na.rm = TRUE),
hogares_SinCobertura  = sum(Saneamiento_SinCobertura, na.rm = TRUE),
total_hogares         = n(),
.groups = "drop"
) %>%
mutate(
pct_deCalidad    = round(100 * hogares_deCalidad / total_hogares, 1),
pct_noCalidad    = round(100 * hogares_noCalidad / total_hogares, 1),
pct_Letrina      = round(100 * hogares_Letrina / total_hogares, 1),
pct_Privado      = round(100 * hogares_Privado / total_hogares, 1),
pct_UsoPublico   = round(100 * hogares_UsoPublico / total_hogares, 1),
pct_SinCobertura = round(100 * hogares_SinCobertura / total_hogares, 1)
) %>%
arrange(desc(total_hogares))
resumen_saneamiento
# Intención de migrar en 6 meses
resumen_intencion_6M <- data_migracion %>%
group_by(nombre_dpt) %>%
summarise(
sinmov = sum(`6M_sinmov`, na.rm = TRUE),
mudar_barrio = sum(`6M_Mudar_barrio`, na.rm = TRUE),
depto = sum(`6M_Depto`, na.rm = TRUE),
venezuela = sum(`6M_Venezuela`, na.rm = TRUE),
otro_pais = sum(`6M_OtroPais`, na.rm = TRUE),
mismo_dpto = sum(`6M_MismoDpto`, na.rm = TRUE),
.groups = "drop"
)
resumen_intencion_6M
# Tiempo de residencia en lugar en que se encuentra actualmente
resumen_meses_lugar <- data_migracion %>%
group_by(nombre_dpt, meses_en_lugar) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(intro5) %>%
mutate(
pct = round(100 * n / sum(n), 1)   # porcentaje dentro de cada ciudad
) %>%
arrange(intro5, meses_en_lugar)
resumen_meses_lugar
# Tiempo de residencia en lugar en que se encuentra actualmente
resumen_meses_lugar <- data_migracion %>%
group_by(nombre_dpt, meses_en_lugar) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(nombre_dpt) %>%
mutate(
pct = round(100 * n / sum(n), 1)   # porcentaje dentro de cada ciudad
) %>%
arrange(intro5, meses_en_lugar)
resumen_meses_lugar
# Tiempo de residencia en lugar en que se encuentra actualmente
resumen_meses_lugar <- data_migracion %>%
group_by(nombre_dpt, meses_en_lugar) %>%
summarise(n = n(), .groups = "drop") %>%
group_by(nombre_dpt) %>%
mutate(
pct = round(100 * n / sum(n), 1)   # porcentaje dentro de cada ciudad
) %>%
arrange(nombre_dpt, meses_en_lugar)
resumen_meses_lugar
# ACCESO A AGUA
resumen_agua <- data_migracion %>%
distinct(id_hogar, nombre_dpt, Acueducto_casa, AguaPublica_fueradecasa,
Agua_FuentesNaturales, Agua_FuentesPrivadas, Agua_NoAcceso) %>%
group_by(nombre_dpt) %>%
summarise(
hogares_con_Acueducto = sum(Acueducto_casa, na.rm = TRUE),
hogares_con_AguaPublica_fuera = sum(AguaPublica_fueradecasa, na.rm = TRUE),
hogares_con_AguaNatural = sum(Agua_FuentesNaturales, na.rm = TRUE),
hogares_con_AguaPrivada = sum(Agua_FuentesPrivadas, na.rm = TRUE),
hogares_sin_Agua = sum(Agua_NoAcceso, na.rm = TRUE),
total_hogares = n(),
.groups = "drop"
) %>%
mutate(
pct_Acueducto = round(100 * hogares_con_Acueducto / total_hogares, 1),
pct_AguaPublica_fuera = round(100 * hogares_con_AguaPublica_fuera / total_hogares, 1),
pct_AguaNatural = round(100 * hogares_con_AguaNatural / total_hogares, 1),
pct_AguaPrivada = round(100 * hogares_con_AguaPrivada / total_hogares, 1),
pct_NoAcceso = round(100 * hogares_sin_Agua / total_hogares, 1)
)
resumen_agua
# CAMINAR PARA ACCEDER A AGUA (CORTO < 30 MIN, LARGO > 30 MIN)
resumen_caminar <- data_migracion %>%
distinct(id_hogar, resumen_agua, Agua_caminar_largo, Agua_caminar_corto) %>%
group_by(resumen_agua) %>%
summarise(
hogares_largo = sum(Agua_caminar_largo, na.rm = TRUE),
hogares_corto = sum(Agua_caminar_corto, na.rm = TRUE),
total_hogares = n(),
.groups = "drop"
) %>%
mutate(
pct_largo = round(100 * hogares_largo / total_hogares, 1),
pct_corto = round(100 * hogares_corto / total_hogares, 1)
) %>%
arrange(desc(total_hogares))
# ACCESO A SANEAMIENTO
resumen_saneamiento <- data_migracion %>%
distinct(id_hogar, nombre_dpt,
Saneamiento_deCalidad, Saneamiento_noCalidad,
Saneamiento_Letrina, Saneamiento_Privado,
Saneamiento_UsoPublico, Saneamiento_SinCobertura) %>%
group_by(nombre_dpt) %>%
summarise(
hogares_deCalidad     = sum(Saneamiento_deCalidad, na.rm = TRUE),
hogares_noCalidad     = sum(Saneamiento_noCalidad, na.rm = TRUE),
hogares_Letrina       = sum(Saneamiento_Letrina, na.rm = TRUE),
hogares_Privado       = sum(Saneamiento_Privado, na.rm = TRUE),
hogares_UsoPublico    = sum(Saneamiento_UsoPublico, na.rm = TRUE),
hogares_SinCobertura  = sum(Saneamiento_SinCobertura, na.rm = TRUE),
total_hogares         = n(),
.groups = "drop"
) %>%
mutate(
pct_deCalidad    = round(100 * hogares_deCalidad / total_hogares, 1),
pct_noCalidad    = round(100 * hogares_noCalidad / total_hogares, 1),
pct_Letrina      = round(100 * hogares_Letrina / total_hogares, 1),
pct_Privado      = round(100 * hogares_Privado / total_hogares, 1),
pct_UsoPublico   = round(100 * hogares_UsoPublico / total_hogares, 1),
pct_SinCobertura = round(100 * hogares_SinCobertura / total_hogares, 1)
) %>%
arrange(desc(total_hogares))
resumen_saneamiento
