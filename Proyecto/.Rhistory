# Data set Hacinamiento y Productos Financieros
data_test_prueba_hip_producto <- data_prueba_hip_producto %>%
filter(hacinamiento %in% c("Sin hacinamiento","Moderado", "Crítico"))
# Comparación variables y  medios de vida
tabla_prueba_hip_producto <- table(
data_test_prueba_hip_producto$hacinamiento,
data_test_prueba_hip_producto$acceso_financiero
)
tabla_prueba_hip_producto
prop.table(tabla_prueba_hip_producto, 1)
data_test <- data_prueba_hip_producto %>%
filter(hacinamiento %in% c("Sin hacinamiento", "Crítico")) %>%
droplevels()
tabla_prueba <- table(data_test$hacinamiento, data_test$acceso_financiero)
x <- tabla_prueba[, "1"]
n <- rowSums(tabla_prueba)
prueba <- prop.test(x, n,
alternative = "greater",
correct = FALSE)
prueba
p_valor <- prueba$p.value
z_obs   <- sqrt(unname(prueba$statistic)) * sign(diff(prueba$estimate))
alpha   <- 0.05
tipo_prueba <- prueba$alternative  # "two.sided", "greater", "less"
media <- 0
# Se definen los valores para realizar el grafico-------------
x <- seq(-4, 4, length.out = 1000)
df <- tibble(
x = x,
H0 = dnorm(x, mean = media, sd = 1),
H1 = dnorm(x, mean = z_obs, sd = 1)
)
# Valores críticos e intervalo según tipo de prueba
if (tipo_prueba == "two.sided") {
z_crit <- c(qnorm(alpha / 2), qnorm(1 - alpha / 2))
z_IC   <- c(-1.96, 1.96)
} else if (tipo_prueba == "greater") {
z_crit <- c(NA, qnorm(1 - alpha))
z_IC   <- c(media, z_crit[2])
} else {  # "less"
z_crit <- c(qnorm(alpha), NA)
z_IC   <- c(z_crit[1], media)
}
z_critico <- ifelse(is.na(z_crit[2]), z_crit[1], z_crit[2])
# Gráfico principal---------------------------------------------
p_z <- ggplot(df, aes(x)) +
# Curvas de H0 y H1
geom_line(aes(y = H0, color = "H0: sin efecto (μ = 0)"), size = 1.1) +
geom_line(aes(y = H1, color = "H1: con efecto observado"), size = 1.1, linetype = "dashed") +
# Región crítica
{
if (tipo_prueba == "two.sided") {
geom_area(data = df |> filter(x <= z_crit[1]), aes(y = H0), fill = "red", alpha = 0.3) +
geom_area(data = df |> filter(x >= z_crit[2]), aes(y = H0), fill = "red", alpha = 0.3)
} else if (tipo_prueba == "greater") {
geom_area(data = df |> filter(x >= z_crit[2]), aes(y = H0), fill = "red", alpha = 0.3)
} else {
geom_area(data = df |> filter(x <= z_crit[1]), aes(y = H0), fill = "red", alpha = 0.3)
}
} +
# Media e intervalo bajo H₀
geom_vline(xintercept = media, color = "gray40", size = 0.8) +
geom_vline(xintercept = z_IC, color = "black", linetype = "dotted", size = 0.9) +
# Marcadores
geom_point(aes(x = z_obs, y = 0), color = "black", size = 4, shape = 17) +
geom_point(aes(x = z_critico, y = 0), color = "red", size = 4, shape = 17) +
# Etiquetas
annotate("text", x = media, y = 0.42, label = "μ = 0", color = "gray40",
size = 4.5, fontface = "italic") +
annotate("text", x = z_obs, y = 0.025,
label = paste0("Z observado = ", round(z_obs, 3)),
color = "black", size = 3.3, vjust = -0.5) +
annotate("text", x = z_critico, y = 0.025,
label = paste0("Z crítico = ", round(z_critico, 2)),
color = "red", size = 3.3, vjust = -0.5) +
annotate("text", x = 0, y = -0.02,
label = paste0("p-valor = ", round(p_valor, 4)),
color = "black", size = 3.5, fontface = "italic") +
# Estilo general
scale_color_manual(values = c(
"H0: sin efecto (μ = 0)" = "blue",
"H1: con efecto observado" = "darkgreen"
)) +
coord_cartesian(ylim = c(-0.05, 0.45)) +
theme_minimal(base_size = 14) +
theme(legend.position = "top",
plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
plot.subtitle = element_text(size = 10, hjust = 0.5)) +
labs(
title = "Acceso financiero: prueba de comparación (Sin hacinamiento Vs Hacinamiento crítico)",
subtitle = paste0(" Distribución normal estándar (Z) , Prueba unilateral de diferencia de proporciones (α = ", alpha, ")"),
x = "Valor Z",
y = "Densidad",
color = "Distribución"
)
p_z
# Guardar en PNG
ggsave("stores/Distribucion_prueba_acceso_financiero.png",plot = p_z, width = 8, height = 5, dpi = 300)
# Filtrar solo Moderado y Crítico
data_test_MC <- data_prueba_hip_producto %>%
filter(hacinamiento %in% c("Moderado", "Crítico")) %>%
droplevels()
# Tabla para la prueba
tabla_MC <- table(data_test_MC$hacinamiento, data_test_MC$acceso_financiero)
tabla_MC
# Valores para la prueba
x_MC <- tabla_MC[, "1"]  # éxitos (con acceso)
n_MC <- rowSums(tabla_MC)  # total por grupo
# Prueba de diferencias de proporciones
prueba_MC <- prop.test(x_MC, n_MC,
alternative = "greater", # H₁: Moderado > Crítico
correct = FALSE)
prueba_MC
p_valor <- prueba_MC$p.value
z_obs   <- sqrt(unname(prueba_MC$statistic)) * sign(diff(prueba_MC$estimate))
alpha   <- 0.05
tipo_prueba <- prueba_MC$alternative  # "two.sided", "greater", "less"
media <- 0
# Se definen los valores para realizar el grafico-------------
x <- seq(-4, 4, length.out = 1000)
df <- tibble(
x = x,
H0 = dnorm(x, mean = media, sd = 1),
H1 = dnorm(x, mean = z_obs, sd = 1)
)
# Valores críticos e intervalo según tipo de prueba
if (tipo_prueba == "two.sided") {
z_crit <- c(qnorm(alpha / 2), qnorm(1 - alpha / 2))
z_IC   <- c(-1.96, 1.96)
} else if (tipo_prueba == "greater") {
z_crit <- c(NA, qnorm(1 - alpha))
z_IC   <- c(media, z_crit[2])
} else {  # "less"
z_crit <- c(qnorm(alpha), NA)
z_IC   <- c(z_crit[1], media)
}
z_critico <- ifelse(is.na(z_crit[2]), z_crit[1], z_crit[2])
# Gráfico principal---------------------------------------------
p_z <- ggplot(df, aes(x)) +
# Curvas de H0 y H1
geom_line(aes(y = H0, color = "H0: sin efecto (μ = 0)"), size = 1.1) +
geom_line(aes(y = H1, color = "H1: con efecto observado"), size = 1.1, linetype = "dashed") +
# Región crítica
{
if (tipo_prueba == "two.sided") {
geom_area(data = df |> filter(x <= z_crit[1]), aes(y = H0), fill = "red", alpha = 0.3) +
geom_area(data = df |> filter(x >= z_crit[2]), aes(y = H0), fill = "red", alpha = 0.3)
} else if (tipo_prueba == "greater") {
geom_area(data = df |> filter(x >= z_crit[2]), aes(y = H0), fill = "red", alpha = 0.3)
} else {
geom_area(data = df |> filter(x <= z_crit[1]), aes(y = H0), fill = "red", alpha = 0.3)
}
} +
# Media e intervalo bajo H₀
geom_vline(xintercept = media, color = "gray40", size = 0.8) +
geom_vline(xintercept = z_IC, color = "black", linetype = "dotted", size = 0.9) +
# Marcadores
geom_point(aes(x = z_obs, y = 0), color = "black", size = 4, shape = 17) +
geom_point(aes(x = z_critico, y = 0), color = "red", size = 4, shape = 17) +
# Etiquetas
annotate("text", x = media, y = 0.42, label = "μ = 0", color = "gray40",
size = 4.5, fontface = "italic") +
annotate("text", x = z_obs, y = 0.025,
label = paste0("Z observado = ", round(z_obs, 3)),
color = "black", size = 3.3, vjust = -0.5) +
annotate("text", x = z_critico, y = 0.025,
label = paste0("Z crítico = ", round(z_critico, 2)),
color = "red", size = 3.3, vjust = -0.5) +
annotate("text", x = 0, y = -0.02,
label = paste0("p-valor = ", round(p_valor, 4)),
color = "black", size = 3.5, fontface = "italic") +
# Estilo general
scale_color_manual(values = c(
"H0: sin efecto (μ = 0)" = "blue",
"H1: con efecto observado" = "darkgreen"
)) +
coord_cartesian(ylim = c(-0.05, 0.45)) +
theme_minimal(base_size = 14) +
theme(legend.position = "top",
plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
plot.subtitle = element_text(size = 10, hjust = 0.5)) +
labs(
title = "Acceso financiero: prueba de comparación (Hacinamiento moderado Vs Hacinamiento crítico)",
subtitle = paste0(" Distribución normal estándar (Z) , Prueba unilateral de diferencia de proporciones (α = ", alpha, ")"),
x = "Valor Z",
y = "Densidad",
color = "Distribución"
)
p_z
# Guardar en PNG
ggsave("stores/Distribucion_prueba_acceso_financiero_2.png",plot = p_z, width = 8, height = 5, dpi = 300)
preg_multi <- c("alojamiento3")
cols_multi <- names(data_filtrada)[str_detect(
names(data_filtrada),
paste0("^(", paste(preg_multi, collapse="|"), ")_")
)]
data_alojamiento3 <- data_filtrada %>%
pivot_longer(
cols = all_of(cols_multi),
names_to = c("pregunta", "respuesta"),
names_pattern = "([^_]+)_(.*)",
values_to = "valor"
) %>%
filter(valor == 1)%>%
mutate(respuesta = str_remove(respuesta, "^alojamiento3_"))
resumen_aloj3 <- data_alojamiento3 %>%
count(respuesta, name = "conteo") %>%
arrange(desc(conteo))
resumen_aloj3
ggplot(resumen_aloj3, aes(x = reorder(respuesta, -conteo), y = conteo, fill = respuesta)) +
geom_col() +
theme_minimal() +
labs(
title = "Problemas relacionados con la vivienda y el entorno",
x = "Tipo de problema reportado",
y = "Número de hogares"
) +
theme(axis.text.x = element_text(angle = 45, hjust = 1),
legend.position = "none")
# Pasar a formato largo (solo respuestas marcadas = 1)
data_aloj3 <- data_filtrada %>%
pivot_longer(
cols = all_of(cols_multi),
names_to = c("pregunta", "respuesta"),
names_pattern = "([^_]+)_(.*)",
values_to = "valor"
) %>%
filter(valor == 1)
resumen_aloj3_menciones <- data_aloj3 %>%
count(respuesta, name = "conteo") %>%
arrange(desc(conteo))%>%
mutate(respuesta = str_remove(respuesta, "^alojamiento3_"))
resumen_aloj3_hogar <- data_aloj3 %>%
group_by(respuesta) %>%
summarise(n_hogares = n_distinct(id_hogar), .groups = "drop")%>%
mutate(respuesta = str_remove(respuesta, "^alojamiento3_"))
plot_aloj3_menciones <- ggplot(resumen_aloj3_menciones,
aes(x = respuesta, y = conteo, fill = respuesta)) +
geom_col() +
labs(title = "Problemas de vivienda (menciones)",
x = "Problema reportado", y = "Número de menciones") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
plot_aloj3_hogar <- ggplot(resumen_aloj3_hogar,
aes(x = respuesta, y = n_hogares, fill = respuesta)) +
geom_col() +
labs(title = "Problemas de vivienda (hogares únicos)",
x = "Problema reportado", y = "Número de hogares") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none")
# Mostrar juntos
plot_aloj3_menciones + plot_aloj3_hogar
vars_entorno <- c(
"alojamiento3_alojamiento3_no_conflic",
"alojamiento3_alojamiento3_no_higiene",
"alojamiento3_alojamiento3_no_lnfaestruc",
"alojamiento3_alojamiento3_no_privacidad",
"alojamiento3_alojamiento3_desastres",
"alojamiento3_alojamiento3_ninguna",
"alojamiento3_alojamiento3_otro"
)
resumen_entorno <- data_filtrada %>%
group_by(hacinamiento) %>%
summarise(across(all_of(vars_entorno), ~ sum(. == "1", na.rm = TRUE)))
resumen_entorno
resumen_aloj3_hacinamiento <- resumen_entorno %>%
select(hacinamiento, starts_with("alojamiento3")) %>%
pivot_longer(
cols = -hacinamiento,
names_to = "problema",
values_to = "conteo"
) %>%
group_by(hacinamiento) %>%
mutate(
total = sum(conteo, na.rm = TRUE),
porcentaje = round((conteo / total) * 100, 1),
problema = gsub("alojamiento3_alojamiento3_", "", problema)  # limpiar nombres
) %>%
left_join(totales_hogares, by = "hacinamiento") %>%
mutate(
porcentaje_hogares = round((conteo / total_hogares) * 100, 1),
producto = str_remove(problema, "alojamiento3_alojamiento3_")
)
# --- Gráfico Problemas de vivienda ---
ggplot(resumen_aloj3_hacinamiento, aes(x = problema, y = porcentaje_hogares, fill = hacinamiento)) +
geom_col(position = "dodge") +
scale_x_discrete(labels = c(
"desastres"     = "Desastres",
"ninguna"       = "Ninguna",
"no_conflic"    = "Conflicto",
"no_higiene"    = "No Higiene",
"no_lnfaestruc" = "No Infraestructura",
"no_privacidad" = "No Privacidad",
"otro"          = "Otros"
)) +
labs(
title = "Problemas relacionados con la vivienda y el entorno",
x = "Problema reportado",
y = "% de hogares"
) +
theme_minimal(base_size = 12) +
theme(
axis.text.x = element_text(angle = 45, hjust = 1)
)
problemas_cols <- c(
"alojamiento3_alojamiento3_desastres",
"alojamiento3_alojamiento3_no_conflic",
"alojamiento3_alojamiento3_no_higiene",
"alojamiento3_alojamiento3_no_lnfaestruc",
"alojamiento3_alojamiento3_no_privacidad",
"alojamiento3_alojamiento3_otro"
)
data_probs <- data_filtrada %>%
mutate(problemas_viv =
if_else(rowSums(select(., all_of(problemas_cols)) == 1, na.rm = TRUE) > 0,
1, 0)
)
# Tabla para la prueba Sin hacinamiento vs Crítico
tabla_probs_SC <- table(
data_probs$hacinamiento,
data_probs$problemas_viv
)
tabla_probs_SC
prop.table(tabla_probs_SC, 1)
# Filtrar solo Sin y Crítico
data_test_SC <- data_probs %>%
filter(hacinamiento %in% c("Sin hacinamiento", "Crítico")) %>%
droplevels()
# Tabla
tabla_SC <- table(data_test_SC$hacinamiento, data_test_SC$problemas_viv)
tabla_SC
# Éxitos y totales
x_SC <- tabla_SC[, "1"]
n_SC <- rowSums(tabla_SC)
# Prueba unilateral: Crítico > Sin hacinamiento
prueba_SC <- prop.test(x_SC, n_SC,
alternative = "less",
correct = FALSE)
prueba_SC
p_valor <- prueba_SC$p.value
z_obs   <- sqrt(unname(prueba_SC$statistic)) * sign(diff(prueba_SC$estimate))
alpha   <- 0.05
tipo_prueba <- prueba_SC$alternative  # "less"
media <- 0
# ============================================================
# Curvas teóricas de H₀ y H₁
# ============================================================
x <- seq(-4, 4, length.out = 1000)
df <- tibble(
x = x,
H0 = dnorm(x, mean = media, sd = 1),
H1 = dnorm(x, mean = z_obs, sd = 1)
)
# ============================================================
# Valores críticos e intervalo según tipo de prueba
# ============================================================
if (tipo_prueba == "two.sided") {
z_crit <- c(qnorm(alpha / 2), qnorm(1 - alpha / 2))
z_IC   <- c(-1.96, 1.96)
} else if (tipo_prueba == "greater") {
z_crit <- c(NA, qnorm(1 - alpha))
z_IC   <- c(media, z_crit[2])
} else {  # "less"
z_crit <- c(qnorm(alpha), NA)
z_IC   <- c(z_crit[1], media)
}
z_critico <- ifelse(is.na(z_crit[2]), z_crit[1], z_crit[2])
# ============================================================
# GRAFICAR DISTRIBUCIONES H₀ Y H₁
# ============================================================
p_SC <- ggplot(df, aes(x)) +
# Curvas de H0 y H1
geom_line(aes(y = H0, color = "H0: sin efecto (μ = 0)"), size = 1.1) +
geom_line(aes(y = H1, color = "H1: con efecto observado"), size = 1.1, linetype = "dashed") +
# Región crítica
geom_area(data = df |> filter(x <= z_crit[1]), aes(y = H0), fill = "red", alpha = 0.3) +
# Media e intervalo bajo H₀
geom_vline(xintercept = media, color = "gray40", size = 0.8) +
geom_vline(xintercept = z_IC, color = "black", linetype = "dotted", size = 0.9) +
# Marcadores
geom_point(aes(x = z_obs, y = 0), color = "black", size = 4, shape = 17) +
geom_point(aes(x = z_critico, y = 0), color = "red", size = 4, shape = 17) +
# Etiquetas
annotate("text", x = media, y = 0.42, label = "μ = 0", color = "gray40",
size = 4.5, fontface = "italic") +
annotate("text", x = z_obs, y = 0.025,
label = paste0("Z observado = ", round(z_obs, 3)),
color = "black", size = 3.3, vjust = -0.5) +
annotate("text", x = z_critico, y = 0.025,
label = paste0("Z crítico = ", round(z_critico, 2)),
color = "red", size = 3.3, vjust = -0.5) +
annotate("text", x = 0, y = -0.02,
label = paste0("p-valor = ", round(p_valor, 4)),
color = "black", size = 3.5, fontface = "italic") +
# Estilo general
scale_color_manual(values = c(
"H0: sin efecto (μ = 0)" = "blue",
"H1: con efecto observado" = "darkgreen"
)) +
coord_cartesian(ylim = c(-0.05, 0.45)) +
theme_minimal(base_size = 14) +
theme(legend.position = "top",
plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
plot.subtitle = element_text(size = 10, hjust = 0.5)) +
labs(
title = "Problemas en Vivienda: prueba de comparación (Sin hacinamiento Vs Hacinamiento crítico)",
subtitle = paste0(" Distribución normal estándar (Z) , Prueba unilateral de diferencia de proporciones (α = ", alpha, ")"),
x = "Valor Z",
y = "Densidad",
color = "Distribución"
)
p_SC
# Guardar en PNG
ggsave("stores/Distribucion_prueba_problemas_vivienda.png",plot = p_SC, width = 8, height = 5, dpi = 300)
data_test_viv <- data_probs %>%
filter(hacinamiento %in% c("Moderado", "Crítico")) %>%
droplevels()
tabla_viv <- table(data_test_viv$hacinamiento, data_test_viv$problemas_viv)
tabla_viv
x_viv <- tabla_viv[, "1"]
n_viv <- rowSums(tabla_viv)
prueba_viv <- prop.test(
x_viv, n_viv,
alternative = "greater", # Crítico > Moderado
correct = FALSE
)
prueba_viv
p_valor <- prueba_viv$p.value
z_obs   <- sqrt(unname(prueba_viv$statistic)) * sign(diff(prueba_viv$estimate))
alpha   <- 0.05
tipo_prueba <- prueba_viv$alternative  # "less"
media <- 0
# ============================================================
# Curvas teóricas de H₀ y H₁
# ============================================================
x <- seq(-4, 4, length.out = 1000)
df <- tibble(
x = x,
H0 = dnorm(x, mean = media, sd = 1),
H1 = dnorm(x, mean = z_obs, sd = 1)
)
# ============================================================
# Valores críticos e intervalo según tipo de prueba
# ============================================================
if (tipo_prueba == "two.sided") {
z_crit <- c(qnorm(alpha / 2), qnorm(1 - alpha / 2))
z_IC   <- c(-1.96, 1.96)
} else if (tipo_prueba == "greater") {
z_crit <- c(NA, qnorm(1 - alpha))
z_IC   <- c(media, z_crit[2])
} else {  # "less"
z_crit <- c(qnorm(alpha), NA)
z_IC   <- c(z_crit[1], media)
}
z_critico <- ifelse(is.na(z_crit[2]), z_crit[1], z_crit[2])
# ============================================================
# GRAFICAR DISTRIBUCIONES H₀ Y H₁
# ============================================================
p_SC <- ggplot(df, aes(x)) +
# Curvas de H0 y H1
geom_line(aes(y = H0, color = "H0: sin efecto (μ = 0)"), size = 1.1) +
geom_line(aes(y = H1, color = "H1: con efecto observado"), size = 1.1, linetype = "dashed") +
# Región crítica
geom_area(data = df |> filter(x <= z_crit[1]), aes(y = H0), fill = "red", alpha = 0.3) +
# Media e intervalo bajo H₀
geom_vline(xintercept = media, color = "gray40", size = 0.8) +
geom_vline(xintercept = z_IC, color = "black", linetype = "dotted", size = 0.9) +
# Marcadores
geom_point(aes(x = z_obs, y = 0), color = "black", size = 4, shape = 17) +
geom_point(aes(x = z_critico, y = 0), color = "red", size = 4, shape = 17) +
# Etiquetas
annotate("text", x = media, y = 0.42, label = "μ = 0", color = "gray40",
size = 4.5, fontface = "italic") +
annotate("text", x = z_obs, y = 0.025,
label = paste0("Z observado = ", round(z_obs, 3)),
color = "black", size = 3.3, vjust = -0.5) +
annotate("text", x = z_critico, y = 0.025,
label = paste0("Z crítico = ", round(z_critico, 2)),
color = "red", size = 3.3, vjust = -0.5) +
annotate("text", x = 0, y = -0.02,
label = paste0("p-valor = ", round(p_valor, 4)),
color = "black", size = 3.5, fontface = "italic") +
# Estilo general
scale_color_manual(values = c(
"H0: sin efecto (μ = 0)" = "blue",
"H1: con efecto observado" = "darkgreen"
)) +
coord_cartesian(ylim = c(-0.05, 0.45)) +
theme_minimal(base_size = 14) +
theme(legend.position = "top",
plot.title = element_text(size = 12, face = "bold", hjust = 0.5),
plot.subtitle = element_text(size = 10, hjust = 0.5)) +
labs(
title = "Problemas en Vivienda: prueba de comparación (Hacinamiento moderado Vs Hacinamiento crítico)",
subtitle = paste0(" Distribución normal estándar (Z) , Prueba unilateral de diferencia de proporciones (α = ", alpha, ")"),
x = "Valor Z",
y = "Densidad",
color = "Distribución"
)
p_SC
# Guardar en PNG
ggsave("stores/Distribucion_prueba_problemas_vivienda_2.png",plot = p_SC, width = 8, height = 5, dpi = 300)
#Test Shapiro
by(data_filtrada$pct_vivienda, data_filtrada$hacinamiento, shapiro.test)
#Prueba global
kruskal.test(pct_vivienda ~ hacinamiento, data = data_filtrada)
#Prueba global
pairwise.wilcox.test(
data_filtrada$pct_vivienda,
data_filtrada$hacinamiento,
p.adjust.method = "bonferroni"
)
