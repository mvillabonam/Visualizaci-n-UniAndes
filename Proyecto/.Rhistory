"miembros21",  # Tiempo dedicado
"miembros22",  # Horas trabajadas
"miembros23",  # Trabajaria mas
"miembros23a",  # quiere trabajar mas
"miembros30",  # Cuenta con contrato formal
"miembros30b",   # Seguridad social en salud
"miembros31a",  # Seguridad social pension
"miembros21b",  # Rango de ingresos
"miembros24a",  # Reporto dificultades para encontrar trabajo
"miembros24b_dificultades_nodocu",  ### Razones ####
"miembros24b_dificultades_familia",
"miembros24b_dificultades_discrimina",
"miembros24b_dificultades_noconocimi",
"miembros24b_dificultades_noempleo",
"miembros24b_dificultades_noofertas",
"miembros24b_dificultades_noexperiencia",
"miembros24b_dificultades_otra",
"miembros24b_nosabe",
"miembros24b_noresponde" #############
)
# Resumen de valores perdidos (NA) en estas variables
na_resumen_mediosvida <- sapply(data_bogota[vars_mediosvida], function(x) sum(is.na(x)))
na_resumen_mediosvida
rm(na_resumen_mediosvida)
vars_24b <- c(
"miembros24b_dificultades_nodocu",
"miembros24b_dificultades_familia",
"miembros24b_dificultades_discrimina",
"miembros24b_dificultades_noconocimi",
"miembros24b_dificultades_noempleo",
"miembros24b_dificultades_noofertas",
"miembros24b_dificultades_noexperiencia",
"miembros24b_dificultades_otra",
"miembros24b_nosabe",
"miembros24b_noresponde"
)
data_bogota <- data_bogota %>%
rowwise() %>%
mutate(
across(all_of(vars_24b), ~ case_when(
#En caso de que no haya reportado dificultades con miembros24a = no, no ha buscado empleo, no sabe
miembros24a %in% c("no", "no ha buscado empleo", "no sabe") & is.na(.x) ~ 0,
# Pero si respondio que si encontro dificultades (miembros24a = si) y hay al menos una de las variables igual a 1, se asume que el resto no ocurrieron
miembros24a == "si" & any(c_across(all_of(vars_24b)) == 1, na.rm = TRUE) & is.na(.x) ~ 0,
TRUE ~ .x
))
) %>%
ungroup()
# Resumen de valores perdidos (NA) en estas variables
na_resumen_mediosvida <- sapply(data_bogota[vars_mediosvida], function(x) sum(is.na(x)))
na_resumen_mediosvida
vars_principales <- c(
"miembros21",
"miembros30",
"miembros30b",
"miembros31a",
"miembros21b"
)
tabla_cruzada_miembros21 <- data_bogota %>%
count(miembros21, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros21
tabla_cruzada_miembros30 <- data_bogota %>%
count(miembros30, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros30
tabla_cruzada_miembros30b <- data_bogota %>%
count(miembros30b, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros30b
tabla_cruzada_miembros31a <- data_bogota %>%
count(miembros31a, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros31a
tabla_cruzada_miembros21b <- data_bogota %>%
count(miembros21b, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros21b
##### SALUD ######
p1 <- ggplot(data_bogota %>%
filter(!is.na(miembros30b)) %>%
count(meses_en_lugar, miembros30b) %>%
mutate(miembros30b = str_wrap(miembros30b, width = 25)), # salto de línea
aes(x = meses_en_lugar, y = n, fill = miembros30b)) +
geom_col(position = "dodge") +
labs(
title = "Acceso a seguridad social en salud",
x = "Meses en el lugar",
y = "Número de hogares",
fill = "Respuesta"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
plot.title = element_text(size = 12, face = "bold"),
legend.position = "bottom",
legend.title = element_text(size = 9),
legend.text = element_text(size = 8)
)
##### PENSION ######
p2 <- ggplot(data_bogota %>%
filter(!is.na(miembros31a)) %>%
count(meses_en_lugar, miembros31a) %>%
mutate(miembros31a = str_wrap(miembros31a, width = 25)), # salto de línea
aes(x = meses_en_lugar, y = n, fill = miembros31a)) +
geom_col(position = "dodge") +
labs(
title = "Acceso a seguridad social en pensiones",
x = "Meses en el lugar",
y = "Número de hogares",
fill = "Respuesta"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
plot.title = element_text(size = 12, face = "bold"),
legend.position = "bottom",
legend.title = element_text(size = 9),
legend.text = element_text(size = 8)
)
grid.arrange(p1, p2, ncol = 2)
ggplot(data_bogota %>%
filter(!is.na(miembros21b)) %>%
count(meses_en_lugar, miembros21b) %>%
mutate(miembros21b = str_wrap(miembros21b, width = 30)),  # ajusta ancho del texto
aes(x = meses_en_lugar, y = n, fill = miembros21b)) +
geom_col(position = "dodge", width = 0.8) +
labs(
title = "Rangos de ingresos mensuales",
x = "Meses en el lugar",
y = "Número de hogares",
fill = "Ingreso mensual"
) +
theme_minimal(base_size = 12) +
theme(
legend.position = "bottom",
legend.title = element_text(size = 9),
legend.text = element_text(size = 8),
axis.text.x = element_text(angle = 30, hjust = 1)
)
vars_dificultades <- c(
"miembros24b_dificultades_nodocu",
"miembros24b_dificultades_familia",
"miembros24b_dificultades_discrimina",
"miembros24b_dificultades_noconocimi",
"miembros24b_dificultades_noempleo",
"miembros24b_dificultades_noofertas",
"miembros24b_dificultades_noexperiencia",
"miembros24b_dificultades_otra",
"miembros24b_nosabe",
"miembros24b_noresponde"
)
dificultades_long <- data_bogota %>%
select(all_of(vars_dificultades)) %>%
pivot_longer(cols = everything(),
names_to = "dificultad",
values_to = "valor") %>%
filter(valor == 1)
# Para las dificultades agrupadas
cruce_dificultades <- data_bogota %>%
select(meses_en_lugar, all_of(vars_dificultades)) %>%
pivot_longer(cols = -meses_en_lugar,
names_to = "dificultad",
values_to = "valor") %>%
filter(valor == 1) %>%
count(meses_en_lugar, dificultad, name = "frecuencia") %>%
pivot_wider(names_from = meses_en_lugar,
values_from = frecuencia,
values_fill = 0)
cruce_dificultades
ggplot(cruce_dificultades,
aes(x = meses_en_lugar, y = frecuencia, fill = dificultad)) +
geom_col(position = "dodge") +
labs(
title = "Dificultades reportadas según tiempo de permanencia",
x = "Meses en el lugar",
y = "Número de hogares",
fill = "Dificultad"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 9),
legend.position = "bottom",
legend.text = element_text(size = 8)
)
cruce_dificultades_long <- data_bogota %>%
select(meses_en_lugar, all_of(vars_dificultades)) %>%
pivot_longer(cols = -meses_en_lugar,
names_to = "dificultad",
values_to = "valor") %>%
filter(valor == 1) %>%
count(meses_en_lugar, dificultad, name = "frecuencia") %>%
mutate(
dificultad = recode(dificultad,
"miembros24b_dificultades_nodocu"       = "Falta de documentos",
"miembros24b_dificultades_familia"      = "Responsabilidades familiares",
"miembros24b_dificultades_discrimina"   = "Discriminación",
"miembros24b_dificultades_noconocimi"   = "Falta de conocimiento",
"miembros24b_dificultades_noempleo"     = "No hay empleo disponible",
"miembros24b_dificultades_noofertas"    = "No hay ofertas adecuadas",
"miembros24b_dificultades_noexperiencia"= "Falta de experiencia",
"miembros24b_dificultades_otra"         = "Otra dificultad",
"miembros24b_nosabe"                    = "No sabe",
"miembros24b_noresponde"                = "Prefiere no responder",
.default = dificultad
),
dificultad = str_wrap(dificultad, width = 25)  # salto de línea automático
)
ggplot(cruce_dificultades_long,
aes(x = meses_en_lugar, y = frecuencia, fill = dificultad)) +
geom_col(position = "dodge") +
labs(
title = "Dificultades reportadas según tiempo de permanencia",
x = "Meses en el lugar",
y = "Número de hogares",
fill = "Dificultad"
) +
theme_minimal() +
theme(
axis.text.x   = element_text(angle = 45, hjust = 1, size = 9),
legend.position = "bottom",
legend.title = element_text(size = 8),
legend.text  = element_text(size = 7)
) +
guides(fill = guide_legend(nrow = 3, byrow = TRUE))
g_seg_soc <- gridExtra::arrangeGrob(p1, p2, ncol = 2)
ggsave("stores/seguridad_social_bogota.png", g_seg_soc, width = 12, height = 5, dpi = 300)
ggsave("stores/ingresos_meses_bogota.png", g_ingresos, width = 12, height = 6, dpi = 300)
# INGRESOS A LO LARGO DEL TIEMPO -------------------------------------
g_ingresos <- ggplot(data_bogota %>%
filter(!is.na(miembros21b)) %>%
count(meses_en_lugar, miembros21b) %>%
mutate(miembros21b = str_wrap(miembros21b, width = 30)),  # ajusta ancho del texto
aes(x = meses_en_lugar, y = n, fill = miembros21b)) +
geom_col(position = "dodge", width = 0.8) +
labs(
title = "Rangos de ingresos mensuales",
x = "Meses en el lugar",
y = "Número de hogares",
fill = "Ingreso mensual"
) +
theme_minimal(base_size = 12) +
theme(
legend.position = "bottom",
legend.title = element_text(size = 9),
legend.text = element_text(size = 8),
axis.text.x = element_text(angle = 30, hjust = 1)
)
vars_mediosvida <- c(
"miembros21",  # Tiempo dedicado
"miembros22",  # Horas trabajadas
"miembros23",  # Trabajaria mas
"miembros23a",  # quiere trabajar mas
"miembros30",  # Cuenta con contrato formal
"miembros30b",   # Seguridad social en salud
"miembros31a",  # Seguridad social pension
"miembros21b",  # Rango de ingresos
"miembros24a",  # Reporto dificultades para encontrar trabajo
"miembros24b_dificultades_nodocu",  ### Razones ####
"miembros24b_dificultades_familia",
"miembros24b_dificultades_discrimina",
"miembros24b_dificultades_noconocimi",
"miembros24b_dificultades_noempleo",
"miembros24b_dificultades_noofertas",
"miembros24b_dificultades_noexperiencia",
"miembros24b_dificultades_otra",
"miembros24b_nosabe",
"miembros24b_noresponde" #############
)
# Resumen de valores perdidos (NA) en estas variables
na_resumen_mediosvida <- sapply(data_bogota[vars_mediosvida], function(x) sum(is.na(x)))
na_resumen_mediosvida
rm(na_resumen_mediosvida)
# IMPUTAR NAS------------------------
vars_24b <- c(
"miembros24b_dificultades_nodocu",
"miembros24b_dificultades_familia",
"miembros24b_dificultades_discrimina",
"miembros24b_dificultades_noconocimi",
"miembros24b_dificultades_noempleo",
"miembros24b_dificultades_noofertas",
"miembros24b_dificultades_noexperiencia",
"miembros24b_dificultades_otra",
"miembros24b_nosabe",
"miembros24b_noresponde"
)
data_bogota <- data_bogota %>%
rowwise() %>%
mutate(
across(all_of(vars_24b), ~ case_when(
#En caso de que no haya reportado dificultades con miembros24a = no, no ha buscado empleo, no sabe
miembros24a %in% c("no", "no ha buscado empleo", "no sabe") & is.na(.x) ~ 0,
# Pero si respondio que si encontro dificultades (miembros24a = si) y hay al menos una de las variables igual a 1, se asume que el resto no ocurrieron
miembros24a == "si" & any(c_across(all_of(vars_24b)) == 1, na.rm = TRUE) & is.na(.x) ~ 0,
TRUE ~ .x
))
) %>%
ungroup()
# Resumen de valores perdidos (NA) en estas variables
na_resumen_mediosvida <- sapply(data_bogota[vars_mediosvida], function(x) sum(is.na(x)))
# ESTADÍSTICAS -------------------------------------------
vars_principales <- c(
"miembros21",
"miembros30",
"miembros30b",
"miembros31a",
"miembros21b"
)
tabla_cruzada_miembros21 <- data_bogota %>%
count(miembros21, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros21
tabla_cruzada_miembros30 <- data_bogota %>%
count(miembros30, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros30
tabla_cruzada_miembros30b <- data_bogota %>%
count(miembros30b, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros30b
tabla_cruzada_miembros31a <- data_bogota %>%
count(miembros31a, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros31a
tabla_cruzada_miembros21b <- data_bogota %>%
count(miembros21b, meses_en_lugar) %>%
pivot_wider(
names_from = meses_en_lugar,
values_from = n,
values_fill = 0
)
tabla_cruzada_miembros21b
# SEGURIDAD SOCIAL ---------------------------------------
p1 <- ggplot(data_bogota %>%
filter(!is.na(miembros30b)) %>%
count(meses_en_lugar, miembros30b) %>%
mutate(miembros30b = str_wrap(miembros30b, width = 25)), # salto de línea
aes(x = meses_en_lugar, y = n, fill = miembros30b)) +
geom_col(position = "dodge") +
labs(
title = "Acceso a seguridad social en salud",
x = "Meses en el lugar",
y = "Número de hogares",
fill = "Respuesta"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
plot.title = element_text(size = 12, face = "bold"),
legend.position = "bottom",
legend.title = element_text(size = 9),
legend.text = element_text(size = 8)
)
# PENSION ----------------------------------------------------
p2 <- ggplot(data_bogota %>%
filter(!is.na(miembros31a)) %>%
count(meses_en_lugar, miembros31a) %>%
mutate(miembros31a = str_wrap(miembros31a, width = 25)), # salto de línea
aes(x = meses_en_lugar, y = n, fill = miembros31a)) +
geom_col(position = "dodge") +
labs(
title = "Acceso a seguridad social en pensiones",
x = "Meses en el lugar",
y = "Número de hogares",
fill = "Respuesta"
) +
theme_minimal() +
theme(
axis.text.x = element_text(angle = 45, hjust = 1, size = 8),
plot.title = element_text(size = 12, face = "bold"),
legend.position = "bottom",
legend.title = element_text(size = 9),
legend.text = element_text(size = 8)
)
g_seg_soc <- gridExtra::arrangeGrob(p1, p2, ncol = 2)
ggsave("stores/seguridad_social_bogota.png", g_seg_soc, width = 12, height = 5, dpi = 300)
# INGRESOS A LO LARGO DEL TIEMPO -------------------------------------
g_ingresos <- ggplot(data_bogota %>%
filter(!is.na(miembros21b)) %>%
count(meses_en_lugar, miembros21b) %>%
mutate(miembros21b = str_wrap(miembros21b, width = 30)),  # ajusta ancho del texto
aes(x = meses_en_lugar, y = n, fill = miembros21b)) +
geom_col(position = "dodge", width = 0.8) +
labs(
title = "Rangos de ingresos mensuales",
x = "Meses en el lugar",
y = "Número de hogares",
fill = "Ingreso mensual"
) +
theme_minimal(base_size = 12) +
theme(
legend.position = "bottom",
legend.title = element_text(size = 9),
legend.text = element_text(size = 8),
axis.text.x = element_text(angle = 30, hjust = 1)
)
ggsave("stores/ingresos_meses_bogota.png", g_ingresos, width = 12, height = 6, dpi = 300)
# DIFICULTADES -------------------------------------------------
vars_dificultades <- c(
"miembros24b_dificultades_nodocu",
"miembros24b_dificultades_familia",
"miembros24b_dificultades_discrimina",
"miembros24b_dificultades_noconocimi",
"miembros24b_dificultades_noempleo",
"miembros24b_dificultades_noofertas",
"miembros24b_dificultades_noexperiencia",
"miembros24b_dificultades_otra",
"miembros24b_nosabe",
"miembros24b_noresponde"
)
dificultades_long <- data_bogota %>%
select(all_of(vars_dificultades)) %>%
pivot_longer(cols = everything(),
names_to = "dificultad",
values_to = "valor") %>%
filter(valor == 1)
# Para las dificultades agrupadas
cruce_dificultades <- data_bogota %>%
select(meses_en_lugar, all_of(vars_dificultades)) %>%
pivot_longer(cols = -meses_en_lugar,
names_to = "dificultad",
values_to = "valor") %>%
filter(valor == 1) %>%
count(meses_en_lugar, dificultad, name = "frecuencia") %>%
pivot_wider(names_from = meses_en_lugar,
values_from = frecuencia,
values_fill = 0)
# GRÁFICO
cruce_dificultades_long <- data_bogota %>%
select(meses_en_lugar, all_of(vars_dificultades)) %>%
pivot_longer(cols = -meses_en_lugar,
names_to = "dificultad",
values_to = "valor") %>%
filter(valor == 1) %>%
count(meses_en_lugar, dificultad, name = "frecuencia") %>%
mutate(
dificultad = recode(dificultad,
"miembros24b_dificultades_nodocu"       = "Falta de documentos",
"miembros24b_dificultades_familia"      = "Responsabilidades familiares",
"miembros24b_dificultades_discrimina"   = "Discriminación",
"miembros24b_dificultades_noconocimi"   = "Falta de conocimiento",
"miembros24b_dificultades_noempleo"     = "No hay empleo disponible",
"miembros24b_dificultades_noofertas"    = "No hay ofertas adecuadas",
"miembros24b_dificultades_noexperiencia"= "Falta de experiencia",
"miembros24b_dificultades_otra"         = "Otra dificultad",
"miembros24b_nosabe"                    = "No sabe",
"miembros24b_noresponde"                = "Prefiere no responder",
.default = dificultad
),
dificultad = str_wrap(dificultad, width = 25)  # salto de línea automático
)
g_dificultades <- ggplot(cruce_dificultades_long,
aes(x = meses_en_lugar, y = frecuencia, fill = dificultad)) +
geom_col(position = "dodge") +
labs(
title = "Dificultades reportadas según tiempo de permanencia",
x = "Meses en el lugar",
y = "Número de hogares",
fill = "Dificultad"
) +
theme_minimal() +
theme(
axis.text.x   = element_text(angle = 45, hjust = 1, size = 9),
legend.position = "bottom",
legend.title = element_text(size = 8),
legend.text  = element_text(size = 7)
) +
guides(fill = guide_legend(nrow = 3, byrow = TRUE))
ggsave("stores/dificultades_por_permanencia_bogota.png", g_dificultades, width = 12, height = 7, dpi = 300)
rm(
vars_mediosvida, vars_24b, vars_principales, vars_dificultades,
tabla_cruzada_miembros21, tabla_cruzada_miembros30, tabla_cruzada_miembros30b,
tabla_cruzada_miembros31a, tabla_cruzada_miembros21b,
dificultades_long, cruce_dificultades, cruce_dificultades_long,
p1, p2, g_seg_soc, g_ingresos, g_dificultades
)
